---
title: "Dart / Flutter ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜ç®¡ç†ã‚’ Pub workspaces Ã— Melos 7 ç³»ã¸ç§»è¡Œã™ã‚‹"
emoji: "ğŸƒ"
type: "tech"
topics: [ "flutter", "dart", "melos", "pubworkspaces" ]
publication_name: "yumemi_inc"
published: true
---

## ã¯ã˜ã‚ã«

ã“ã‚“ã«ã¡ã¯ã€ãŸã£ã¤ãƒ¼[@tatsutakein][X] ã§ã™ã€‚

Dart / Flutter ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãƒ¢ãƒãƒ¬ãƒæ§‹ç¯‰ã«ã™ã‚‹å ´åˆã€ã“ã‚Œã¾ã§ã¯ [Melos](https://github.com/invertase/melos) ã‚’ä½¿ç”¨ã—ã¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ä¾å­˜ã‚’ç®¡ç†ã™ã‚‹ã“ã¨ãŒä¸€èˆ¬çš„ã§ã—ãŸã€‚  
ã—ã‹ã—ã€Dart 3.6 ã‹ã‚‰ [Pub workspaces](https://dart.dev/tools/pub/workspaces) ãŒæ­£å¼ã«ã‚µãƒãƒ¼ãƒˆã•ã‚Œã€ã‚ˆã‚Šè»½é‡ãªä¾å­˜ç®¡ç†ãŒå¯èƒ½ã«ãªã£ã¦ã„ã¾ã™ã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€Melos ã‹ã‚‰ Pub workspaces ã¸ã®ä¾å­˜ç®¡ç†éƒ¨åˆ†ã®ç§»è¡Œæ‰‹é †ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

## ç§»è¡Œã®èƒŒæ™¯

Melos ã¯å„ªã‚ŒãŸãƒ¢ãƒãƒ¬ãƒç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã™ãŒã€Pub workspaces ã®å°å…¥ã«ã‚ˆã‚Šã€ã‚ˆã‚Šè»½é‡ãªä¾å­˜ç®¡ç†ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚  
ã¾ãŸã€2025/01/16 ç¾åœ¨é–‹ç™ºæ®µéšã® Melos 7 ç³» ãŒ Pub workspaces ã¨ã®è¦ªå’Œæ€§ã‚’é«˜ã‚ã¦ãŠã‚Šã€ç§»è¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¨ã—ã¦é©ã—ã¦ã„ã‚‹ã¨åˆ¤æ–­ã—ã¾ã—ãŸã€‚

## ç§»è¡Œæ‰‹é †

### 1. pubspec_overrides.yaml ã®å‰Šé™¤

ã¾ãšã€Melos 6 ç³»ã¾ã§ã§ç”Ÿæˆã•ã‚Œã‚‹ `pubspec_overrides.yaml` ã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```bash
find . -name "pubspec_overrides.yaml" -type f -delete
```

`.gitignore` ã‹ã‚‰ã‚‚ `pubspec_overrides.yaml` ã®è¨˜è¿°ã‚’å‰Šé™¤ã—ã¾ã™ã€‚  
ã¾ãŸã€ `melos bs` å®Ÿè¡Œæ™‚ã«ã€å®Ÿæ…‹ã¨ã—ã¦ `flutter pub get` ãŒå®Ÿè¡Œã•ã‚Œã¦ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ãŸã‚ `.flutter-plugins`, `.flutter-plugins-dependencies` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff text:.gitignore
 /.dart_tool/*
+/.flutter-plugins
+/.flutter-plugins-dependencies
 
-/pubspec_overrides.yaml
```

### 2. Pub workspaces ã¸ã®ç§»è¡Œ

ãƒ«ãƒ¼ãƒˆã® `pubspec.yaml` ã« `workspace` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff yaml:pubspec.yaml
 name: template_workspace
 environment:
   sdk: ^3.6.0
 
+workspace:
+  - apps/app
+  - apps/catalog
+  - packages/cores/data
+  - packages/cores/designsystem
+  - packages/cores/model
+  - packages/cores/ui
+  - packages/features/setting
```

å„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã® `pubspec.yaml` ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã« `resolution: workspace` ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff yaml:apps/app/pubspec.yaml
 name: flutter_app
 description: "A new Flutter project."
 publish_to: 'none'
 version: 0.0.1
 
 environment:
   sdk: ^3.6.0
   flutter: ^3.27.1
 
+resolution: workspace
```

### 3. Melos 7 ç³»ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

æ¬¡ã«ã€Melos 7 ç³»ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚
2025/01/16 ç¾åœ¨ã§ã¯ã¾ã é–‹ç™ºæ®µéšã®ãŸã‚ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
dart pub global activate Melos 7.0.0-dev.3
```

### 4. melos.yaml ã®ç§»è¡Œ

`melos.yaml` ã®å†…å®¹ã‚’ãƒ«ãƒ¼ãƒˆã® `pubspec.yaml` ã«ç§»å‹•ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ç§»è¡Œã§ãã¾ã™ã€‚  
ãªãŠã€ `melos.yaml` ã¯ä¸è¦ã«ãªã‚‹ãŸã‚å‰Šé™¤ã—ã¾ã™ã€‚

```diff yaml:pubspec.yaml
 name: template_workspace
 environment:
   sdk: ^3.6.0
 
 workspace:
   - apps/app
   - apps/catalog
 
 # çœç•¥  
 ...
 
+melos:
+  # ä»¥é™ã®å†…å®¹ã‚’ melos.yaml ã‹ã‚‰ç§»å‹•
+  sdkPath: .fvm/flutter_sdk
+
+  ide:
+    intellij:
+      enabled: false
+  # çœç•¥
+  ...
```

ãŸã ã—ã€ä»¥ä¸‹ã®é …ç›®ã¯ç§»è¡Œä¸è¦ã§ã™ã€‚

- name
- packages

[å…¬å¼ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ã‚¤ãƒ‰](https://github.com/invertase/melos?tab=readme-ov-file#migrate-to-melos-7xx)
ã§ã‚‚ä¸è¦ã ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

![Except for the packages and name](/images/37717d5be277ee/except_for_the_packages_and_name.png)

### 5. ä¾å­˜é–¢ä¿‚ã®å†æ§‹ç¯‰

æœ€å¾Œã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä¾å­˜é–¢ä¿‚ã‚’å†æ§‹ç¯‰ã—ã¾ã™ã€‚

```bash
melos bs
```

## æ³¨æ„ç‚¹

ç§»è¡Œæ™‚ã«ä»¥ä¸‹ã®ç‚¹ã«æ³¨æ„ãŒå¿…è¦ã§ã™ã€‚

1. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®äº’æ›æ€§ç¢ºèª
    - ä¾‹ï¼štheme_extensions_builder ã‚’ 4.0.0 ã‹ã‚‰ 3.1.0 ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™
    - ç†ç”±ï¼šé–“æ¥çš„ã«ä¾å­˜ã—ã¦ã„ã‚‹ source_gen ã®ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é•ã„ã«ã‚ˆã‚‹å•é¡Œã‚’é¿ã‘ã‚‹ãŸã‚
2. ãƒ“ãƒ«ãƒ‰æ¤œè¨¼
    - ã‚­ãƒ£ãƒ¬ãƒƒãƒˆ(^) ãªã©ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¦ã„ã‚‹å ´åˆã€ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚  
      ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã€ãƒ“ãƒ«ãƒ‰æ¤œè¨¼ã‚’è¡Œã†ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

## å‚è€ƒä¾‹

ã‚†ã‚ã¿ã§é–‹ç™ºã‚’é€²ã‚ã¦ã„ã‚‹ Flutter ã®ãƒ¢ãƒã‚¤ãƒ«ã‚¢ãƒ—ãƒªãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚æ—¢ã«å¯¾å¿œã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚
ä»¥ä¸‹ã® Pull Request ã‚’ãœã²å‚è€ƒã«ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

https://github.com/yumemi-inc/flutter-mobile-project-template/pull/371

## ã¾ã¨ã‚

Pub workspaces ã¸ç§»è¡Œã™ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šè»½é‡ã§ç®¡ç†ã—ã‚„ã™ã„ä¾å­˜ç®¡ç†ãŒå®Ÿç¾ã§ãã¾ã™ã€‚  
ã¾ãŸã€Melos 7 ç³»ã¨ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚Šæ—¢å­˜ã®æ©Ÿèƒ½ã‚’æãªã†ã“ã¨ãªãç§»è¡ŒãŒå¯èƒ½ã§ã™ã€‚

## å‚è€ƒ

- [Workspaces | Dart](https://dart.dev/tools/pub/workspaces)
- [Migrate to Melos 7.x.x | invertase/Melos](https://github.com/invertase/melos?tab=readme-ov-file#migrate-to-melos-7xx)

<!-- Links -->

[X]: https://x.com/tatsutakein
